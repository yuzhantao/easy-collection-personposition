webpackJsonp([1],{0:function(e,t){},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},6:function(e,t){},7:function(e,t){},Mq60:function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("7+uW"),i={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":this.$route.path,router:"",mode:"horizontal","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"},on:{select:this.handleSelect}},[t("el-menu-item",{attrs:{index:"/"}},[this._v("硬件管理")]),this._v(" "),t("el-menu-item",{attrs:{index:"/realtime"}},[this._v("实时数据")]),this._v(" "),t("el-menu-item",{attrs:{index:"/history"}},[this._v("历史数据")])],1)],1)},staticRenderFns:[]},c={name:"App",components:{ViewHeader:a("VU/8")({name:"ViewHeader",data:function(){return{}},methods:{handleSelect:function(e,t){}}},i,!1,null,null,null).exports}},l={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("el-container",[t("el-header",[t("view-header")],1),this._v(" "),t("el-main",[t("router-view")],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(c,l,!1,function(e){a("imNF")},null,null).exports,s=a("/ocq"),r=a("//Fk"),d=a.n(r),u=a("mtWM"),v=a.n(u),p=a("zL8q"),h=a.n(p),m=v.a.create({timeout:1e4});m.defaults.withCredentials=!0,m.defaults.headers.post["Content-Type"]="application/json",m.interceptors.response.use(function(e){return 200===e.status?e:(Object(p.Message)({message:e.status+" - "+(e.data?e.data:e.statusText),type:"warning"}),e)},function(e){return 405===e.response.status?M.push("/"):(console.log(e.response),Object(p.Message)({message:e.response.status+" - "+(e.response.data?e.response.data:e.response.statusText),type:"error"})),d.a.reject(e)});var f=m,g={getDevices:function(e){return f.get("devices/person-position-devices/list",{params:e})},getDeviceStatistics:function(e){return f.get("devices-count",{params:e})}},b={name:"DeviceList",data:function(){return{currentPage:1,pageSize:5,pageTotal:1,devices:[],onlineDeviceCount:0,offlineDeviceCount:0,deviceSearchForm:{deviceState:null,deviceCode:null,deviceType:null,deviceIp:null}}},computed:{devicesHandler:function(){for(var e in this.devices){var t=this.devices[e];t.deviceState="online"===t.deviceState?"在线":"离线"}return this.devices}},created:function(){},mounted:function(){this.init(),this.getDeives()},methods:{init:function(){var e=this;g.getDeviceStatistics().then(function(t){t.data&&(e.onlineDeviceCount=t.data.onlineDevice,e.offlineDeviceCount=t.data.offlineDevice)})},getDeives:function(){var e=this,t={page:this.currentPage-1,deviceState:this.deviceSearchForm.deviceState,deviceCode:this.deviceSearchForm.deviceCode,deviceType:this.deviceSearchForm.deviceType,ip:this.deviceSearchForm.deviceIp,size:this.pageSize};g.getDevices(t).then(function(t){t.data&&(e.devices=t.data.content,e.pageTotal=t.data.totalElements-1,e.currentPage=t.data.pageable.pageNumber+1)})},goBack:function(){window.history.back()},handleSizeChange:function(e){this.pageSize=e,this.getDeives()},handleCurrentChange:function(e){this.currentPage=e,this.getDeives()}}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-page-header",{attrs:{content:"设备列表"},on:{back:e.goBack}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form",{staticClass:"device-list-charts",attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"当前活动数量"}},[a("span",[e._v(e._s(e.onlineDeviceCount))])]),e._v(" "),a("el-form-item",{attrs:{label:"当前离线设备总数"}},[a("span",[e._v(e._s(e.offlineDeviceCount))])])],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.deviceSearchForm}},[a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{attrs:{placeholder:"状态"},model:{value:e.deviceSearchForm.deviceState,callback:function(t){e.$set(e.deviceSearchForm,"deviceState",t)},expression:"deviceSearchForm.deviceState"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),a("el-option",{attrs:{label:"在线",value:"online"}}),e._v(" "),a("el-option",{attrs:{label:"离线",value:"offline"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"设备编号"}},[a("el-input",{attrs:{placeholder:"设备编号"},model:{value:e.deviceSearchForm.deviceCode,callback:function(t){e.$set(e.deviceSearchForm,"deviceCode",t)},expression:"deviceSearchForm.deviceCode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"IP地址"}},[a("el-input",{attrs:{placeholder:"IP地址"},model:{value:e.deviceSearchForm.deviceIp,callback:function(t){e.$set(e.deviceSearchForm,"deviceIp",t)},expression:"deviceSearchForm.deviceIp"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备类型"}},[a("el-select",{attrs:{placeholder:"设备类型"},model:{value:e.deviceSearchForm.deviceType,callback:function(t){e.$set(e.deviceSearchForm,"deviceType",t)},expression:"deviceSearchForm.deviceType"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),a("el-option",{attrs:{label:"人员定位",value:"人员定位设备"}})],1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getDeives}},[e._v("查询")])],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.devicesHandler,stripe:""}},[a("el-table-column",{attrs:{prop:"deviceCode",label:"设备编号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceType",label:"设备类型"}}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceState",label:"设备状态"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ip",label:"IP"}}),e._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"更新日期"}}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作",width:"100"}},[[a("el-button",{attrs:{type:"text",size:"small"}},[e._v("编辑")])]],2)],1)]],2)],1),e._v(" "),a("el-row",{staticClass:"row-bg device-list-pagination",attrs:{type:"flex",justify:"end"}},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.currentPage,"page-sizes":[5,10,20,40],"page-size":e.pageSize,total:e.pageTotal,"prev-text":"上一页","next-text":"下一页"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var _=a("VU/8")(b,S,!1,function(e){a("dM2H")},null,null).exports,y=a("ifoU"),C=a.n(y),D=a("Cg+j"),w=a.n(D),k={name:"RealtimeData",data:function(){return{client:null,deviceMap:new C.a,onlineDeviceCount:0,offlineDeviceCount:0}},created:function(){},mounted:function(){this.init(),this.mqttInit("116.204.171.194",61614,"admin","admin")},methods:{goBack:function(){window.history.back()},init:function(){var e=this;g.getDeviceStatistics().then(function(t){t.data&&(e.onlineDeviceCount=t.data.onlineDevice,e.offlineDeviceCount=t.data.offlineDevice)})},mqttInit:function(e,t,a,n){var i=this,c=this,l={connectTimeout:4e4,clientId:"realtime-data-client",username:a,password:n,clean:!0},o="ws://"+e+":"+t+"/mqtt";this.client=w.a.connect(o,l),this.client.on("connect",function(e){console.log("连接成功！！！"),i.client.subscribe("personpositon/+/tags/+",{qos:0},function(e){e?console.log("订阅失败"):console.log("订阅成功")})}),this.client.on("message",function(e,t){var a=JSON.parse(t.toString());console.log("收到来自",e,"的消息",a),0==c.deviceMap.has(a.deviceCode)&&c.deviceMap.set(a.deviceCode,[]);var n=c.deviceMap.get(a.deviceCode);n.splice(0,0,a),n.length>5&&n.pop(),c.$forceUpdate()})}}},T={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-page-header",{attrs:{content:"实时数据"},on:{back:e.goBack}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form",{staticClass:"device-list-charts",attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"当前活动数量"}},[a("span",[e._v(e._s(e.onlineDeviceCount))])]),e._v(" "),a("el-form-item",{attrs:{label:"当前离线设备总数"}},[a("span",[e._v(e._s(e.offlineDeviceCount))])])],1)],1)],1),e._v(" "),a("el-row",e._l(e.deviceMap,function(t){return a("el-col",{key:t[0],staticClass:"box-card",attrs:{span:4}},[a("el-card",[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("设备:"+e._s(t[0]))])]),e._v(" "),e._l(t[1],function(t){return a("div",{key:t.tagId,staticClass:"text item"},[e._v("\n          "+e._s(t.tagId)+"\n        ")])})],2)],1)}),1)],1)},staticRenderFns:[]};var x=a("VU/8")(k,T,!1,function(e){a("Mq60")},null,null).exports,F=a("mw3O"),z=a.n(F),H={getTagHistorys:function(e){return f.get("tags-history/list?"+e)}},P={name:"HistoryData",data:function(){return{currentPage:1,pageSize:5,pageTotal:1,searchTimeBetween:null,selectedDevices:[],allSelectDeviceCheck:!1,devices:[],tagHistorySearchForm:{},tagHistorys:[]}},mounted:function(){this.getDeives(),this.getTagHistorys()},methods:{onAllSelectDeviceCode:function(){var e=this;this.devices.forEach(function(t){t.checked=e.allSelectDeviceCheck})},onSelectDeviceCode:function(){},onTagHistorySearchSubmit:function(){this.getTagHistorys()},goBack:function(){window.history.back()},handleSizeChange:function(e){this.pageSize=e,this.getDeives()},handleCurrentChange:function(e){this.currentPage=e,this.getDeives()},getDeives:function(){var e=this;g.getDevices({page:0,size:99999}).then(function(t){t.data&&(e.devices=t.data.content)})},changeTimestyle:function(e){var t=new Date(e).toJSON();return new Date(+new Date(t)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")},getTagHistorys:function(){var e=this;console.log(this.searchTimeBetween);var t={page:this.currentPage-1,size:this.pageSize};this.searchTimeBetween&&(t.startTime=this.changeTimestyle(this.searchTimeBetween[0]),t.endTime=this.changeTimestyle(this.searchTimeBetween[1])),this.selectedDevices&&this.selectedDevices.length>0&&(t.deviceCode=this.selectedDevices),t=z.a.stringify(t,{arrayFormat:"repeat"}),H.getTagHistorys(t).then(function(t){t.data&&(e.tagHistorys=t.data.content,e.pageTotal=t.data.totalElements-1,e.currentPage=t.data.pageable.pageNumber+1)})}}},I={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-page-header",{attrs:{content:"历史数据"},on:{back:e.goBack}})],1),e._v(" "),a("el-row",{staticClass:"top",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:1}},[a("el-checkbox",{attrs:{label:"全选",name:"type"},on:{change:e.onAllSelectDeviceCode},model:{value:e.allSelectDeviceCheck,callback:function(t){e.allSelectDeviceCheck=t},expression:"allSelectDeviceCheck"}})],1),e._v(" "),e._l(e.devices,function(t){return a("el-col",{key:t.deviceCode,attrs:{span:2}},[a("el-checkbox",{attrs:{label:t.deviceCode,name:"type"},on:{change:e.onSelectDeviceCode},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"dev.checked"}})],1)})],2),e._v(" "),a("el-row",{staticClass:"top",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:24}},[a("el-form",{staticClass:"align-left",attrs:{inline:!0,model:e.tagHistorySearchForm}},[a("el-form-item",{attrs:{label:"查询时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:e.searchTimeBetween,callback:function(t){e.searchTimeBetween=t},expression:"searchTimeBetween"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onTagHistorySearchSubmit}},[e._v("查询")])],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onTagHistorySearchSubmit}},[e._v("导出")])],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tagHistorys,stripe:""}},[a("el-table-column",{attrs:{prop:"tagType",label:"标签类型",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"createTime",label:"时间",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceCode",label:"设备编号",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"tagId",label:"卡号"}})],1)],1)],1),e._v(" "),a("el-row",{staticClass:"row-bg device-list-pagination",attrs:{type:"flex",justify:"end"}},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.currentPage,"page-sizes":[5,10,20,40],"page-size":e.pageSize,total:e.pageTotal,"prev-text":"上一页","next-text":"下一页"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var B=a("VU/8")(P,I,!1,function(e){a("kUEf")},null,null).exports;n.default.use(s.a);var M=new s.a({routes:[{path:"/",name:"DeviceList",component:_,meta:{title:"人员定位-设备列表"}},{path:"/realtime",name:"RealtimeData",component:x,meta:{title:"人员定位-实时数据"}},{path:"/history",name:"HistoryData",component:B,meta:{title:"人员定位-历史数据"}}]});a("tvR6"),a("e0XP");n.default.config.productionTip=!1,n.default.use(h.a),n.default.prototype.axios=v.a,M.beforeEach(function(e,t,a){e.meta.title&&(document.title=e.meta.title),a()}),new n.default({el:"#app",router:M,components:{App:o},template:"<App/>"})},dM2H:function(e,t){},e0XP:function(e,t){},imNF:function(e,t){},kUEf:function(e,t){},tvR6:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.132c1cebc02595b15f3b.js.map